import { useState } from 'react';
import { vulnerabilityDatabase, severityLevels, learningModules } from '../data/securityKnowledge';
import './VulnerabilityLibrary.css';

function VulnerabilityLibrary() {
  const [selectedCategory, setSelectedCategory] = useState('website');
  const [selectedVuln, setSelectedVuln] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');

  const categories = [
    { id: 'website', name: 'Website Security', icon: 'üåê' },
    { id: 'email', name: 'Email Security', icon: '‚úâÔ∏è' },
    { id: 'server', name: 'Server Security', icon: 'üñ•Ô∏è' },
    { id: 'application', name: 'Application Security', icon: 'üì±' },
    { id: 'data', name: 'Data Security', icon: 'üîê' }
  ];

  const filteredVulns = (vulnerabilityDatabase[selectedCategory] || []).filter(vuln =>
    searchTerm === '' ||
    vuln.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    vuln.description.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="vulnerability-library">
      <div className="library-header">
        <h2>Security Knowledge Base</h2>
        <p>Learn about common security vulnerabilities and how to prevent them</p>
      </div>

      <div className="search-box">
        <input
          type="text"
          placeholder="Search vulnerabilities..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="search-input"
        />
      </div>

      <div className="category-tabs">
        {categories.map(cat => (
          <button
            key={cat.id}
            className={`category-tab ${selectedCategory === cat.id ? 'active' : ''}`}
            onClick={() => {
              setSelectedCategory(cat.id);
              setSelectedVuln(null);
            }}
          >
            <span className="tab-icon">{cat.icon}</span>
            <span className="tab-name">{cat.name}</span>
          </button>
        ))}
      </div>

      <div className="library-content">
        <div className="vuln-list">
          {filteredVulns.map(vuln => (
            <div
              key={vuln.id}
              className={`vuln-card ${selectedVuln?.id === vuln.id ? 'selected' : ''}`}
              onClick={() => setSelectedVuln(vuln)}
            >
              <div className="vuln-card-header">
                <span 
                  className="vuln-severity"
                  style={{ backgroundColor: severityLevels[vuln.severity].color }}
                >
                  {vuln.severity}
                </span>
              </div>
              <h4 className="vuln-name">{vuln.name}</h4>
              <p className="vuln-desc">{vuln.description}</p>
            </div>
          ))}
          {filteredVulns.length === 0 && (
            <p className="no-results">No vulnerabilities found matching your search.</p>
          )}
        </div>

        {selectedVuln && (
          <div className="vuln-detail">
            <div className="detail-header">
              <span 
                className="detail-severity"
                style={{ backgroundColor: severityLevels[selectedVuln.severity].color }}
              >
                {selectedVuln.severity}
              </span>
              <h3>{selectedVuln.name}</h3>
            </div>

            <section className="detail-section">
              <h4>Description</h4>
              <p>{selectedVuln.description}</p>
            </section>

            <section className="detail-section impact">
              <h4>Impact</h4>
              <p>{selectedVuln.impact}</p>
            </section>

            <section className="detail-section">
              <h4>How to Detect</h4>
              <p>{selectedVuln.detection}</p>
            </section>

            <section className="detail-section">
              <h4>How to Fix</h4>
              <ol className="fix-list">
                {selectedVuln.howToFix.map((step, index) => (
                  <li key={index}>{step}</li>
                ))}
              </ol>
            </section>

            {selectedVuln.resources && selectedVuln.resources.length > 0 && (
              <section className="detail-section">
                <h4>Resources</h4>
                <ul className="resource-list">
                  {selectedVuln.resources.map((resource, index) => (
                    <li key={index}>
                      <a href={resource.url} target="_blank" rel="noopener noreferrer">
                        {resource.title} ‚Üí
                      </a>
                    </li>
                  ))}
                </ul>
              </section>
            )}
          </div>
        )}

        {!selectedVuln && (
          <div className="no-selection">
            <div className="no-selection-icon">üìö</div>
            <h3>Select a Vulnerability</h3>
            <p>Click on any vulnerability from the list to learn more about it and how to fix it.</p>
          </div>
        )}
      </div>

      <div className="learning-section">
        <h3>Learning Modules</h3>
        <p>Structured courses to improve your security knowledge</p>
        <div className="modules-grid">
          {learningModules.map(module => (
            <div key={module.id} className="module-card">
              <div className="module-level">{module.level}</div>
              <h4>{module.title}</h4>
              <p>{module.description}</p>
              <div className="module-meta">
                <span className="module-duration">‚è±Ô∏è {module.duration}</span>
                <span className="module-topics">{module.topics.length} topics</span>
              </div>
              <div className="module-topics-list">
                {module.topics.map((topic, index) => (
                  <span key={index} className="topic-tag">{topic}</span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

export default VulnerabilityLibrary;
